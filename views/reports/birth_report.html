
<script type="text/javascript" src="/assets/js/jquery.min.js"></script>

<script type="text/javascript" src="/assets/js/post_parameters.js"></script>
<script type="text/javascript" src="/assets/js/generic_ajaxrequest.js"></script>
<script type="text/javascript" src="/apps/ART/assets/js/arv_number.js"></script>
<script type="text/javascript" src="/assets/js/moment.js"></script>
<script type="text/javascript" src="/assets/js/alertifyjs/alertify.js"></script>
<script type="text/javascript" src="/assets/js/does_connection_exist.js"></script>
<script type="text/javascript" src="/apps/MATERNITY/assets/js/birth_report.js"></script>
<script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js" defer="true"></script>

<link rel="stylesheet" href="/apps/MATERNITY/assets/css/birth_report.css" type="text/css">
<link rel="stylesheet" href="/assets/css/alertifyjs/css/alertify.css" type="text/css">
<style>
    .cell {
        border-bottom: dotted 1px #000
    }
    table {
        -moz-user-select: none;
    }
    .inputFrameClass{
        background-color: #fff;
    }
</style>
<body id="mateme">
<div id="container">
    <div id="content">
        <form>
            <input type="text" name="summary" id="birth_report"
                   tt_onLoad="__$('keyboard').style.display = 'none';changeClearButton();fetchMotherDemographics();"
                   tt_pageStyleClass= "NoControls" helpText="" class="white" optional="true"/>
        </form>
    </div>
</div>
</body>

<script>
    var patientID = sessionStorage.getItem("patientID");
    var tstCurrentDate = moment(tstCurrentDate).format("YYYY-MM-DD");
    var tt_cancel_destination = "/views/patient_dashboard.html?patient_id=" + patientID;

    function changeClearButton() {
        var sendToEBRS = $('clearButton');
        sendToEBRS.innerHTML = '<span>Send to eBRS</span>';
        sendToEBRS.setAttribute('onmousedown','sendToEBRS();');
    }

    function sendToEBRS() {

        var ebrsHost;
        var ebrsPort;
        var ebrsProtocol;
        var ebrsURL;
        var ebrsPath;

        var ebrsConfig = '/apps/MATERNITY/application.json';

        jQuery.getJSON(ebrsConfig)
            .done((configurations) => {
                var ebrs = configurations.ebrs;
                ebrsHost = ebrs.ebrsHost;
                ebrsPort = ebrs.ebrsPort;
                ebrsProtocol = ebrs.ebrsProtocol;
                ebrsURL = ebrs.ebrsURL;
                ebrsPath = ebrsProtocol + '://' + ebrsHost + ':' + ebrsPort + ebrsURL;

                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && (this.status == 201 || this.status == 200)) {
                        showMessage('Report successfully sent');
                        window.location = '/views/patient_dashboard.html?patient_id=' + patientID;
                    } else if (this.status == 400) {
                        showMessage('Report not sent. Error: Bad request.')
                    } else if (this.status == 500) {
                        showMessage('Report sent without Patient ID')
                    }
                };
                xhttp.open("POST", ebrsPath, true);
                xhttp.setRequestHeader('Content-type','application/json; charset=utf-8');

                var parameters = {
                    "person": {
                        "place_of_birth": "Bwaila Hospital",
                        "hospital_of_birth": "Bwaila Hospital",
                        "birth_district": "Lilongwe",
                        "relationship": "normal",
                        "duplicate": "",
                        "is_exact_duplicate": "",
                        "first_name": "Maternity",
                        "last_name": "Test",
                        "birthdate": "2019-02-28",
                        "gender": "Female",
                        "birth_weight": "3.666",
                        "type_of_birth": "Single",
                        "parents_married_to_each_other": "No",
                        "court_order_attached": "Yes",
                        "mother": {
                            "first_name": "Menop",
                            "last_name": "Menogh",
                            "maiden_name": "Menof",
                            "birthdate": "2002-02-28",
                            "citizenship": "Malawian",
                            "residential_country": "Malawi",
                            "home_district": "Lilongwe",
                            "home_ta": "Chiseka",
                            "home_village": "Austeni",
                            "current_district": "Blantyre",
                            "current_ta": "Kapeni",
                            "current_village": "Ben Ligogo"
                        },
                        "mode_of_delivery": "Vaccum Extraction",
                        "level_of_education": "Primary",
                        "father": {
                            "first_name": "Dan",
                            "last_name": "Doe",
                            "birthdate": "1999-02-28",
                            "citizenship": "Malawian",
                            "residential_country": "Malawi",
                            "home_district": "Blantyre",
                            "home_ta": "Kuntaja",
                            "home_village": "Bakili",
                            "current_district": "Blantyre",
                            "current_ta": "Kunthembwe",
                            "current_village": "Buluzi"
                        },
                        "informant": {
                            "first_name": "Menop",
                            "last_name": "Menogh",
                            "birthdate": "2002-02-28",
                            "citizenship": "Malawian",
                            "residential_country": "Malawi",
                            "other_informant_relationship_to_person": "",
                            "home_district": "Lilongwe",
                            "home_ta": "Chiseka",
                            "home_village": "Austeni",
                            "current_district": "Blantyre",
                            "current_ta": "Kapeni",
                            "current_village": "Ben Ligogo",
                            "phone_number": "Unknown"
                        },
                        "form_signed": "Yes"
                    },
                    "mother_barcode": "",
                    "gestation_at_birth": "36",
                    "number_of_prenatal_visits": "3",
                    "month_prenatal_care_started": "3",
                    "number_of_children_born_alive_inclusive": "3",
                    "number_of_children_born_still_alive": "3",
                    "father_barcode": "",
                    "informant_same_as_mother": "Yes",
                    "date_reported": "2019-02-28",
                    "copy_mother_name": "No",
                    "controller": "person",
                    "action": "create"
                };

                var json = JSON.stringify(parameters);
                xhttp.send(json);
            })
            .fail((error) => {
                console.error(error)
                showMessage('There was an error sending data to eBRS.')
            })

    }
</script>
