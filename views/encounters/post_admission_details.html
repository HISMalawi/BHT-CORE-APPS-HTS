
<script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/touchScreenToolkit.js" defer="true"></script>
<!--script type="text/javascript" src="/public/touchscreentoolkit/lib/javascripts/standard.js" defer="true"></script-->
<script type="text/javascript" src="/assets/js/jquery.min.js"></script>

<script type="text/javascript" src="/assets/js/yes_no_ctrls.js"></script>
<link rel="stylesheet" href="/assets/css/yes_no_ctrls.css" type="text/css">
<script type="text/javascript" src="/assets/js/post_parameters.js"></script>
<script type="text/javascript" src="/assets/js/generic_ajaxrequest.js"></script>
<script type="text/javascript" src="/assets/js/alertifyjs/alertify.js"></script>
<script type="text/javascript" src="/assets/js/does_connection_exist.js"></script>
<script type="text/javascript" src="/assets/js/moment.js"></script>

<link rel="stylesheet" href="/assets/css/alertifyjs/css/alertify.css" type="text/css">

<style>

.inputFrameClass {
  width: 96% !important;
}
</style>

<body id="mateme">
  <div id="container">
    <div id="content">


      <form>
        <input type="text" name="admission_date" 
          id="admission_date" field_type="date" 
          key="admission_date" helpText="Admission Date"  
           tt_pageStyleClass="date" allowFreeText="true"
           /> 

         <input type="text" name="admission_time" 
          id="admission_time" field_type="advancedTime" 
          key="admission_time" helpText="Admission Time"  
          allowFreeText="true" 
           /> 


          <input type="text" name="admission_diagnosis" 
          id="admission_diagnosis" field_type="alpha" 
          key="admission_diagnosis" helpText="Select admission diagnosis"  
          ajaxURL="/search/admission_diagnosis?search_string=" 
          key=admission_time" allowFreeText="true" 
           /> 

          <input type="text" name="next_diagnosis" 
          id="next_diagnosis" field_type="alpha" 
          key="next_diagnosis" helpText="Select the next diagnosis"  
           allowFreeText="true" 
           /> 

          <input type="text" name="other_diagnosis" 
          id="other_diagnosis" field_type="alpha" 
          key="other_diagnosis" helpText="Select the next diagnosis"  
          allowFreeText="true" tt_onLoad="changeNextButton();"
          /> 


      </form>

   </div>
 </div>
</body>

<script>
    var patientID = sessionStorage.getItem("patientID");
    var tstCurrentDate = moment(tstCurrentDate).format("YYYY-MM-DD");
    var tt_cancel_destination = "/views/patient_dashboard.html?patient_id=" + patientID;

  function changeNextButton() {
      var nextButton =  document.getElementById('nextButton');
      nextButton.setAttribute("onmousedown","postObstreticHistory();")
  }

  function postObstreticHistory() {
      var currentTime = moment().format(' HH:mm:ss');
      var encounter_datetime = moment(sessionStorage.sessionDate).format('YYYY-MM-DD');
      encounter_datetime += currentTime;

      var encounter = {
          encounter_type_name: 'OBSTETRIC HISTORY',
          encounter_type_id:  82,
          patient_id: sessionStorage.patientID,
          encounter_datetime: encounter_datetime
      };

      submitParameters(encounter, "/encounters", "postObstetricHistoryObs");
  }

  function postObstetricHistoryObs(encounter) {

      var admissionDate = document.getElementById('admission_date').value;
      var admissionTime = document.getElementById('admission_time').value;
      var admissionDiagnosisOne = document.getElementById('admission_diagnosis').value;
      var admissionDiagnosisTwo= document.getElementById('next_diagnosis').value;
      var admissionDiagnosisThree = document.getElementById('touchscreenInput' + tstCurrentPage).value;

      var admissionDay = admissionDate.split('-')[0];
      var admissionMonth = admissionDate.split('-')[1];
      var admissionYear = admissionDate.split('-')[2];

      var admissionDateValue = admissionYear + '-' + admissionMonth + '-' + admissionDay;

      console.log("Admission diagnosis" + admissionDiagnosisThree);
      var obs = {
          encounter_id: encounter["encounter_id"],
          observations: [
              { concept_id: 7826, value_datetime: admissionDateValue }, 
              { concept_id: 7827, value_text: admissionTime }, 
              { concept_id: 7447, value_text: admissionDiagnosisOne }, 
              { concept_id: 7685, value_text: admissionDiagnosisTwo }, 
              { concept_id: 7685, value_text: admissionDiagnosisThree } 
          ]
      };

      submitParameters(obs, "/observations", "nextPage")
  }

  function nextPage(){
    window.location.href = "/views/patient_dashboard.html?patient_id=" + patientID;

  }
</script>
